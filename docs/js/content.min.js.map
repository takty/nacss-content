{"version":3,"sources":["content.js"],"names":["window","NS","apply","ts","t","alt","src","trim","endsWith","substring","length","idx","lastIndexOf","applyImageAlt","figs","navigator","userAgent","toLowerCase","includes","fig","style","width","fcs","getElementsByTagName","fc","innerHTML","applyFigureCaption","fs","f","aspectRatio","setAspectRatio","observe","mo","MutationObserver","rs","r","target","attributes","w","h","extractIframeSize","replace","height","parseInt","sW","sH","applyIframeAspect","spans","opts","Object","assign","styleList","span","setStyle","type","textDecorationLine","textDecoration","re","RegExp","getAttribute","match","removeAttribute","tar","cls","enabled","val","key","substr","startsWith","dataset","c","join","classList","add","remove","setClass","applyUnderline"],"mappings":"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","file":"content.min.js","sourcesContent":["/**\n * Content\n *\n * @author Takuto Yanagida\n * @version 2021-12-26\n */\n\n'use strict';\n\nwindow['NACSS']            = window['NACSS']            || {};\nwindow['NACSS']['content'] = window['NACSS']['content'] || {};\n\n((NS) => {\n\n\t/**\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t */\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t{\n\t\t/**\n\t\t * Image Alt\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-26\n\t\t */\n\t\t\n\t\tfunction apply(ts) {\n\t\t\tfor (const t of ts) {\n\t\t\t\tif (!t.alt && t.src) {\n\t\t\t\t\tlet src = t.src.trim();\n\t\t\t\t\tif (src.endsWith('/')) src = src.substring(0, src.length - 1);\n\t\t\t\t\tconst idx = src.lastIndexOf('/');\n\t\t\t\t\tif (idx === -1) continue;\n\t\t\t\t\tt.alt = src.substring(idx + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.applyImageAlt = apply;\n\t}\n\t{\n\t\t/**\n\t\t * Figure Caption\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2022-10-13\n\t\t */\n\t\t\n\t\t// Wrap figure captions with spans for Firefox\n\t\tfunction apply(figs) {\n\t\t\tconst ua = window.navigator.userAgent.toLowerCase();\n\t\t\tif (ua.includes('firefox')) {\n\t\t\t\tfor (const fig of figs) {\n\t\t\t\t\tfig.style.width = '';\n\t\t\n\t\t\t\t\tconst fcs = fig.getElementsByTagName('figcaption');\n\t\t\t\t\tconst fc  = fcs.length ? fcs[0] : null;\n\t\t\t\t\tif (fc) {\n\t\t\t\t\t\tfc.innerHTML = `<div>${fc.innerHTML}</div>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.applyFigureCaption = apply;\n\t}\n\t{\n\t\t/**\n\t\t * Iframe Aspect\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2024-10-06\n\t\t */\n\t\t\n\t\tfunction apply(fs) {\n\t\t\tfor (const f of fs) {\n\t\t\t\tif (!f.style.aspectRatio) {\n\t\t\t\t\tsetAspectRatio(f);\n\t\t\t\t}\n\t\t\t}\n\t\t\tobserve(fs);\n\t\t}\n\t\t\n\t\tfunction observe(fs) {\n\t\t\tif (!fs.length) return;\n\t\t\tconst mo = new MutationObserver(rs => {\n\t\t\t\tfor (const r of rs) setAspectRatio(r.target);\n\t\t\t});\n\t\t\tfor (const f of fs) {\n\t\t\t\tmo.observe(f, { attributes: true });\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction setAspectRatio(f) {\n\t\t\tconst [w, h] = extractIframeSize(f);\n\t\t\tif (w && h) {\n\t\t\t\tf.style.aspectRatio = `${w} / ${h}`;\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction extractIframeSize(f) {\n\t\t\tconst uW = f.width.replace(/[0-9]/g, '');\n\t\t\tconst uH = f.height.replace(/[0-9]/g, '');\n\t\t\tif (uW !== uH) return [0, 0];\n\t\t\tlet w = parseInt(f.width);\n\t\t\tlet h = parseInt(f.height);\n\t\t\tif (w && h) return [w, h];\n\t\t\n\t\t\tconst sW = f.style.width;\n\t\t\tconst sH = f.style.height;\n\t\t\tif (!sW.endsWith('px') || !sH.endsWith('px')) return [0, 0];\n\t\t\tw = parseInt(sW);\n\t\t\th = parseInt(sH);\n\t\t\tif (w && h) return [w, h];\n\t\t\treturn [0, 0];\n\t\t}\n\t\t\n\t\tNS.applyIframeAspect = apply;\n\t}\n\t{\n\t\t/**\n\t\t * Underline\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-27\n\t\t */\n\t\t\n\t\tfunction apply(spans, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleList: ':ncUnderline',\n\t\t\t}, opts);\n\t\t\n\t\t\tfor (const span of spans) {\n\t\t\t\tsetStyle(span, opts);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction setStyle(t, opts) {\n\t\t\tlet type = t.style.textDecorationLine;\n\t\t\tif (type === '') type = t.style.textDecoration;  // For Safari\n\t\t\n\t\t\tif (type === 'underline') {\n\t\t\t\tconst re = new RegExp('^text-decoration\\\\s*:\\\\s*' + type + '\\\\s*;?$', 'gi');\n\t\t\t\tif (t.getAttribute('style').trim().match(re)) {\n\t\t\t\t\tt.removeAttribute('style');\n\t\t\t\t} else {\n\t\t\t\t\tif (t.style.textDecorationLine !== '') {\n\t\t\t\t\t\tt.style.textDecorationLine = '';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt.style.textDecoration = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsetClass(t, opts.styleList);\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.applyUnderline = apply;\n\t}\n\n})(window['NACSS']['content']);\n"]}